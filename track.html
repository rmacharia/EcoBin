<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Waste - EcoBin</title>
    <meta name="description" content="Smart waste tracking with AI-powered classification and environmental impact monitoring.">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tiempos+Headline:wght@400;500;700&family=Suisse+Int'l:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leafout.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --color-primary: #2D5A3D;
            --color-secondary: #8B6914;
            --color-background: #FFFFFF;
            --color-text: #3A3A3A;
            --color-accent: #6B8CAE;
            --color-success: #4A6741;
            --color-warning: #B8860B;
            --color-error: #8B4513;
            --font-primary: 'Tiempos Headline', serif;
            --font-secondary: 'Suisse Int\'l', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-secondary);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .font-primary {
            font-family: var(--font-primary);
        }

        .text-primary {
            color: var(--color-primary);
        }

        .bg-primary {
            background-color: var(--color-primary);
        }

        .text-secondary {
            color: var(--color-secondary);
        }

        .bg-secondary {
            background-color: var(--color-secondary);
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(45, 90, 61, 0.1);
        }

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--color-primary);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
        }

        /* Main Content */
        .main-content {
            padding-top: 80px;
            min-height: 100vh;
            padding-bottom: 5rem;
        }

        /* Waste Logging Interface */
        .waste-interface {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(45, 90, 61, 0.1);
            margin-bottom: 2rem;
        }

        .camera-interface {
            border: 2px dashed rgba(45, 90, 61, 0.3);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(45, 90, 61, 0.05);
        }

        .camera-interface:hover {
            border-color: var(--color-primary);
            background: rgba(45, 90, 61, 0.1);
        }

        .camera-icon {
            font-size: 3rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
        }

        /* Waste Categories Grid */
        .waste-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .waste-category {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .waste-category:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .waste-category.selected {
            border-color: var(--color-primary);
            background: rgba(45, 90, 61, 0.1);
        }

        .waste-category.organic { border-color: #4A6741; }
        .waste-category.plastic { border-color: #6B8CAE; }
        .waste-category.paper { border-color: #B8860B; }
        .waste-category.metal { border-color: #8B6914; }
        .waste-category.glass { border-color: #C4A484; }
        .waste-category.electronic { border-color: #2D5A3D; }
        .waste-category.hazardous { border-color: #8B4513; }

        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .category-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-primary);
        }

        .category-description {
            font-size: 0.875rem;
            opacity: 0.7;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--color-primary);
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(45, 90, 61, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(45, 90, 61, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
        }

        /* AI Recognition Result */
        .recognition-result {
            background: rgba(74, 103, 65, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 1px solid #4A6741;
            display: none;
        }

        .recognition-result.show {
            display: block;
        }

        .recognition-confidence {
            font-size: 0.875rem;
            color: var(--color-success);
            margin-bottom: 1rem;
        }

        .suggestions-list {
            list-style: none;
            padding: 0;
        }

        .suggestions-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(45, 90, 61, 0.1);
        }

        .suggestions-list li:last-child {
            border-bottom: none;
        }

        /* Map Container */
        .map-container {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 1rem 0;
        }

        /* Recent Waste Items */
        .waste-log {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(45, 90, 61, 0.1);
            margin-bottom: 1rem;
        }

        .waste-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid rgba(45, 90, 61, 0.1);
            transition: all 0.3s ease;
        }

        .waste-item:hover {
            background: rgba(45, 90, 61, 0.05);
        }

        .waste-item:last-child {
            border-bottom: none;
        }

        .waste-info {
            flex: 1;
        }

        .waste-category-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .waste-category-badge.organic { background: rgba(74, 103, 65, 0.1); color: #4A6741; }
        .waste-category-badge.plastic { background: rgba(107, 140, 174, 0.1); color: #6B8CAE; }
        .waste-category-badge.paper { background: rgba(184, 134, 11, 0.1); color: #B8860B; }
        .waste-category-badge.metal { background: rgba(139, 105, 20, 0.1); color: #8B6914; }
        .waste-category-badge.glass { background: rgba(196, 164, 132, 0.1); color: #C4A484; }
        .waste-category-badge.electronic { background: rgba(45, 90, 61, 0.1); color: #2D5A3D; }
        .waste-category-badge.hazardous { background: rgba(139, 69, 19, 0.1); color: #8B4513; }

        /* Buttons */
        .btn-primary {
            background: var(--color-primary);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-primary:hover {
            background: var(--color-secondary);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--color-primary);
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: 2px solid var(--color-primary);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: var(--color-primary);
            color: white;
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(45, 90, 61, 0.1);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid rgba(45, 90, 61, 0.1);
            padding: 0.5rem 0;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--color-text);
        }

        .nav-item:hover {
            color: var(--color-primary);
        }

        .nav-item.active {
            color: var(--color-primary);
        }

        .nav-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .nav-label {
            font-size: 0.75rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .waste-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .camera-interface {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="max-w-6xl mx-auto px-4 flex items-center justify-between">
            <div class="font-primary text-2xl font-bold text-primary">
                EcoBin
            </div>
            
            <div class="hidden md:flex items-center space-x-8">
                <a href="index.html" class="nav-link" data-nav="index">Dashboard</a>
                <a href="#" class="nav-link active" data-nav="track">Track Waste</a>
                <a href="insights.html" class="nav-link" data-nav="insights">Insights</a>
                <a href="community.html" class="nav-link" data-nav="community">Community</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="connection-status online text-sm">
                    Online
                </div>
                <button class="btn-primary" onclick="window.wastetracker?.startCamera()">
                    üì∑ Scan Waste
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="max-w-6xl mx-auto px-4 py-8">
            <!-- Waste Logging Interface -->
            <div class="waste-interface">
                <h1 class="font-primary text-3xl font-bold text-primary mb-6">
                    Smart Waste Tracking
                </h1>
                <p class="text-lg opacity-80 mb-8">
                    Use AI-powered recognition or manual selection to log your waste items and track their environmental impact.
                </p>

                <!-- Camera Interface -->
                <div class="camera-interface" id="camera-interface" onclick="window.wastetracker?.startCamera()">
                    <div class="camera-icon">üì∑</div>
                    <h3 class="font-semibold mb-2">AI Waste Recognition</h3>
                    <p class="opacity-80">Take a photo of your waste item for automatic classification</p>
                    <div class="mt-4">
                        <button class="btn-primary">Start Camera</button>
                    </div>
                </div>

                <!-- AI Recognition Result -->
                <div class="recognition-result" id="recognition-result">
                    <div class="recognition-confidence" id="recognition-confidence"></div>
                    <h4 class="font-semibold mb-3">AI Classification Result:</h4>
                    <div id="recognition-category" class="mb-4"></div>
                    <h5 class="font-medium mb-2">Disposal Suggestions:</h5>
                    <ul class="suggestions-list" id="suggestions-list"></ul>
                </div>

                <!-- Manual Category Selection -->
                <div class="form-group">
                    <label class="form-label">Or Select Waste Category Manually:</label>
                    <div class="waste-categories" id="waste-categories">
                        <div class="waste-category organic" data-category="organic">
                            <div class="category-icon">üå±</div>
                            <div class="category-name">Organic</div>
                            <div class="category-description">Food scraps, yard waste</div>
                        </div>
                        <div class="waste-category plastic" data-category="plastic">
                            <div class="category-icon">‚ôªÔ∏è</div>
                            <div class="category-name">Plastic</div>
                            <div class="category-description">Bottles, containers</div>
                        </div>
                        <div class="waste-category paper" data-category="paper">
                            <div class="category-icon">üìÑ</div>
                            <div class="category-name">Paper</div>
                            <div class="category-description">Newspapers, cardboard</div>
                        </div>
                        <div class="waste-category metal" data-category="metal">
                            <div class="category-icon">üî©</div>
                            <div class="category-name">Metal</div>
                            <div class="category-description">Cans, foil</div>
                        </div>
                        <div class="waste-category glass" data-category="glass">
                            <div class="category-icon">üçæ</div>
                            <div class="category-name">Glass</div>
                            <div class="category-description">Bottles, jars</div>
                        </div>
                        <div class="waste-category electronic" data-category="electronic">
                            <div class="category-icon">üíª</div>
                            <div class="category-name">Electronic</div>
                            <div class="category-description">Devices, batteries</div>
                        </div>
                        <div class="waste-category hazardous" data-category="hazardous">
                            <div class="category-icon">‚ò†Ô∏è</div>
                            <div class="category-name">Hazardous</div>
                            <div class="category-description">Chemicals, medical</div>
                        </div>
                    </div>
                </div>

                <!-- Waste Details Form -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="form-group">
                        <label class="form-label">Item Name (Optional)</label>
                        <input type="text" class="form-input" id="item-name" placeholder="e.g., Water bottle, Banana peel">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Weight (kg)</label>
                        <input type="number" class="form-input" id="item-weight" placeholder="0.5" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-input" id="item-location" placeholder="Home, Office, School">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Disposal Method</label>
                        <select class="form-select" id="disposal-method">
                            <option value="recycled">Recycled</option>
                            <option value="composted">Composted</option>
                            <option value="landfill">Landfill</option>
                            <option value="hazardous">Hazardous Waste</option>
                            <option value="donated">Donated</option>
                        </select>
                    </div>
                </div>

                <!-- Map for Recycling Centers -->
                <div class="form-group">
                    <label class="form-label">Nearby Recycling Centers</label>
                    <div class="map-container" id="recycling-map"></div>
                </div>

                <!-- Submit Button -->
                <div class="flex gap-4">
                    <button class="btn-primary" id="log-waste-btn" onclick="window.wastetracker?.logWaste()">
                        Log Waste Item
                    </button>
                    <button class="btn-secondary" onclick="window.wastetracker?.resetForm()">
                        Reset Form
                    </button>
                </div>
            </div>

            <!-- Recent Waste Log -->
            <div class="waste-log">
                <h2 class="font-primary text-2xl font-bold text-primary mb-4">
                    Recent Waste Log
                </h2>
                
                <div id="waste-items-list">
                    <div class="waste-item">
                        <div class="waste-info">
                            <div class="waste-category-badge plastic">Plastic</div>
                            <div class="font-semibold">Water Bottle</div>
                            <div class="text-sm opacity-60">500ml ‚Ä¢ Recycled ‚Ä¢ 2 hours ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-success text-sm">+5 points</div>
                            <div class="text-xs opacity-60">0.75kg CO‚ÇÇ saved</div>
                        </div>
                    </div>
                    
                    <div class="waste-item">
                        <div class="waste-info">
                            <div class="waste-category-badge organic">Organic</div>
                            <div class="font-semibold">Banana Peel</div>
                            <div class="text-sm opacity-60">120g ‚Ä¢ Composted ‚Ä¢ 5 hours ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-success text-sm">+3 points</div>
                            <div class="text-xs opacity-60">0.02kg CO‚ÇÇ saved</div>
                        </div>
                    </div>
                    
                    <div class="waste-item">
                        <div class="waste-info">
                            <div class="waste-category-badge paper">Paper</div>
                            <div class="font-semibold">Newspaper</div>
                            <div class="text-sm opacity-60">250g ‚Ä¢ Recycled ‚Ä¢ 1 day ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-success text-sm">+4 points</div>
                            <div class="text-xs opacity-60">0.2kg CO‚ÇÇ saved</div>
                        </div>
                    </div>
                    
                    <div class="waste-item">
                        <div class="waste-info">
                            <div class="waste-category-badge metal">Metal</div>
                            <div class="font-semibold">Aluminum Can</div>
                            <div class="text-sm opacity-60">15g ‚Ä¢ Recycled ‚Ä¢ 2 days ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-success text-sm">+6 points</div>
                            <div class="text-xs opacity-60">0.03kg CO‚ÇÇ saved</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Dashboard</div>
        </a>
        <a href="#" class="nav-item active">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Track</div>
        </a>
        <a href="insights.html" class="nav-item">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">Insights</div>
        </a>
        <a href="community.html" class="nav-item">
            <div class="nav-icon">üåç</div>
            <div class="nav-label">Community</div>
        </a>
    </nav>

    <!-- Load Main Application -->
    <script src="app.js"></script>
    
    <script>
        class WasteTracker {
            constructor() {
                this.selectedCategory = null;
                this.map = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeMap();
                this.checkUrlParams();
            }

            setupEventListeners() {
                // Category selection
                document.querySelectorAll('.waste-category').forEach(category => {
                    category.addEventListener('click', (e) => {
                        this.selectCategory(e.currentTarget.dataset.category);
                    });
                });

                // Form validation
                document.getElementById('item-weight').addEventListener('input', this.validateForm.bind(this));
                document.getElementById('item-location').addEventListener('input', this.validateForm.bind(this));
            }

            checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category');
                if (category) {
                    this.selectCategory(category);
                }
            }

            selectCategory(category) {
                // Remove previous selection
                document.querySelectorAll('.waste-category').forEach(cat => {
                    cat.classList.remove('selected');
                });

                // Add selection to clicked category
                const selectedElement = document.querySelector(`[data-category="${category}"]`);
                if (selectedElement) {
                    selectedElement.classList.add('selected');
                    this.selectedCategory = category;
                }

                this.validateForm();
            }

            async startCamera() {
                try {
                    // Simulate camera interface
                    this.showNotification('Camera starting...', 'info');
                    
                    // Simulate photo capture and AI processing
                    setTimeout(() => {
                        this.simulateAIRecognition();
                    }, 2000);
                    
                } catch (error) {
                    console.error('Camera error:', error);
                    this.showNotification('Camera access denied', 'error');
                }
            }

            async simulateAIRecognition() {
                // Show loading state
                const cameraInterface = document.getElementById('camera-interface');
                cameraInterface.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                    <p>Analyzing waste item...</p>
                `;

                // Simulate AI processing delay
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Get AI classification result
                const result = await window.ecobin.wasteService.classifyWaste('simulated_image_data');
                
                // Show result
                this.showAIResult(result);
                
                // Auto-select the category
                this.selectCategory(result.category);
                
                // Update form with suggestions
                this.updateFormWithAIResult(result);
            }

            showAIResult(result) {
                const resultElement = document.getElementById('recognition-result');
                const confidenceElement = document.getElementById('recognition-confidence');
                const categoryElement = document.getElementById('recognition-category');
                const suggestionsElement = document.getElementById('suggestions-list');

                // Show confidence
                confidenceElement.textContent = `Confidence: ${(result.confidence * 100).toFixed(1)}%`;

                // Show category
                const categoryInfo = window.ecobin.wasteService.categories[result.category];
                categoryElement.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">${categoryInfo.icon}</span>
                        <span class="font-semibold">${categoryInfo.name}</span>
                    </div>
                `;

                // Show suggestions
                suggestionsElement.innerHTML = '';
                result.suggestions.forEach(suggestion => {
                    const li = document.createElement('li');
                    li.textContent = suggestion;
                    suggestionsElement.appendChild(li);
                });

                // Show result panel
                resultElement.classList.add('show');

                // Reset camera interface
                const cameraInterface = document.getElementById('camera-interface');
                cameraInterface.innerHTML = `
                    <div class="camera-icon">üì∑</div>
                    <h3 class="font-semibold mb-2">AI Waste Recognition</h3>
                    <p class="opacity-80">Take another photo or manually select category</p>
                    <div class="mt-4">
                        <button class="btn-primary" onclick="window.wastetracker?.startCamera()">Retake Photo</button>
                    </div>
                `;
            }

            updateFormWithAIResult(result) {
                // Auto-fill item name if not specified
                const itemNameInput = document.getElementById('item-name');
                if (!itemNameInput.value) {
                    itemNameInput.value = `Waste item - ${result.category}`;
                }

                // Set default weight
                const weightInput = document.getElementById('item-weight');
                if (!weightInput.value) {
                    weightInput.value = '0.5';
                }
            }

            async logWaste() {
                if (!this.selectedCategory) {
                    this.showNotification('Please select a waste category', 'error');
                    return;
                }

                const weight = document.getElementById('item-weight').value;
                const location = document.getElementById('item-location').value;
                const itemName = document.getElementById('item-name').value;
                const disposalMethod = document.getElementById('disposal-method').value;

                if (!weight || !location) {
                    this.showNotification('Please fill in required fields', 'error');
                    return;
                }

                const wasteItem = {
                    id: this.generateId(),
                    category: this.selectedCategory,
                    item: itemName || `${this.selectedCategory} item`,
                    weight: parseFloat(weight),
                    location: location,
                    disposalMethod: disposalMethod,
                    date: new Date().toISOString(),
                    syncStatus: window.ecobin.isOnline ? 'synced' : 'pending'
                };

                try {
                    // Log waste item
                    await window.ecobin.wasteService.storeWasteItem(wasteItem);
                    
                    // Calculate environmental impact
                    const impact = await window.ecobin.impactService.calculateImpact(wasteItem);
                    
                    // Show success message
                    this.showNotification(`Waste logged successfully! ${impact.carbonSaved.toFixed(2)}kg CO‚ÇÇ saved`, 'success');
                    
                    // Add to recent items list
                    this.addToRecentItems(wasteItem, impact);
                    
                    // Reset form
                    this.resetForm();
                    
                } catch (error) {
                    console.error('Failed to log waste:', error);
                    this.showNotification('Failed to log waste', 'error');
                }
            }

            addToRecentItems(wasteItem, impact) {
                const categoryInfo = window.ecobin.wasteService.categories[wasteItem.category];
                const timeAgo = 'Just now';
                
                const wasteItemsList = document.getElementById('waste-items-list');
                const newItem = document.createElement('div');
                newItem.className = 'waste-item';
                newItem.innerHTML = `
                    <div class="waste-info">
                        <div class="waste-category-badge ${wasteItem.category}">${categoryInfo.name}</div>
                        <div class="font-semibold">${wasteItem.item}</div>
                        <div class="text-sm opacity-60">${wasteItem.weight}kg ‚Ä¢ ${wasteItem.disposalMethod} ‚Ä¢ ${timeAgo}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-success text-sm">+${Math.floor(wasteItem.weight * 10)} points</div>
                        <div class="text-xs opacity-60">${impact.carbonSaved.toFixed(2)}kg CO‚ÇÇ saved</div>
                    </div>
                `;
                
                // Insert at the beginning
                wasteItemsList.insertBefore(newItem, wasteItemsList.firstChild);
                
                // Animate in
                newItem.style.opacity = '0';
                newItem.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    newItem.style.transition = 'all 0.3s ease';
                    newItem.style.opacity = '1';
                    newItem.style.transform = 'translateY(0)';
                }, 100);
            }

            resetForm() {
                this.selectedCategory = null;
                document.querySelectorAll('.waste-category').forEach(cat => {
                    cat.classList.remove('selected');
                });
                
                document.getElementById('item-name').value = '';
                document.getElementById('item-weight').value = '';
                document.getElementById('item-location').value = '';
                document.getElementById('disposal-method').value = 'recycled';
                
                const resultElement = document.getElementById('recognition-result');
                resultElement.classList.remove('show');
                
                this.validateForm();
            }

            validateForm() {
                const weight = document.getElementById('item-weight').value;
                const location = document.getElementById('item-location').value;
                const submitBtn = document.getElementById('log-waste-btn');
                
                if (this.selectedCategory && weight && location) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Log Waste Item';
                } else {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Please complete required fields';
                }
            }

            initializeMap() {
                // Initialize Leaflet map for recycling centers
                if (typeof L !== 'undefined') {
                    const mapContainer = document.getElementById('recycling-map');
                    this.map = L.map(mapContainer).setView([-1.2921, 36.8219], 12); // Nairobi coordinates
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(this.map);
                    
                    // Add sample recycling centers
                    const recyclingCenters = [
                        { name: 'Nairobi Recycling Center', lat: -1.2921, lng: 36.8219, type: 'General' },
                        { name: 'E-Waste Collection Point', lat: -1.3021, lng: 36.8319, type: 'Electronic' },
                        { name: 'Glass Recycling Facility', lat: -1.2821, lng: 36.8119, type: 'Glass' },
                        { name: 'Hazardous Waste Disposal', lat: -1.3121, lng: 36.8419, type: 'Hazardous' }
                    ];
                    
                    recyclingCenters.forEach(center => {
                        const marker = L.marker([center.lat, center.lng]).addTo(this.map);
                        marker.bindPopup(`<strong>${center.name}</strong><br>Type: ${center.type}`);
                    });
                }
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: ${type === 'error' ? '#8B4513' : '#4A6741'};
                    color: white;
                    padding: 1rem;
                    border-radius: 8px;
                    z-index: 10000;
                    max-width: 300px;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        // Initialize waste tracker when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.wastetracker = new WasteTracker();
        });
    </script>
</body>
</html>